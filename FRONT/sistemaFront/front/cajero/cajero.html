<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Cajero</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <script src="cajero.js"></script>
    <nav class="navbar navbar-dark bg-success">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">Sistema de Caja - Cajero</span>
            <div>
                <span class="text-white me-3" id="userInfo"></span>
                <button class="btn btn-outline-light btn-sm" onclick="logout()">Cerrar Sesión</button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <div class="row">
            <!-- Panel de búsqueda de productos -->
            <div class="col-md-4">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Buscar Producto</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="codigoProducto" class="form-label">Código del Producto</label>
                            <input type="text" class="form-control" id="codigoProducto" placeholder="Escanea o ingresa el código">
                        </div>
                        <button class="btn btn-primary w-100" onclick="buscarProducto()">
                            <i class="bi bi-search"></i> Buscar Producto
                        </button>
                        
                        <!-- Información del producto encontrado -->
                        <div id="productoInfo" class="mt-3" style="display: none;">
                            <div class="card bg-light">
                                <div class="card-body p-3">
                                    <h6 id="nombreProducto" class="card-title mb-1"></h6>
                                    <p class="card-text mb-2">
                                        <small>Descripción: <span id="descripcion"></span></small><br>
                                        <small>Código: <span id="codigoInfo"></span></small><br>
                                        <small>Stock: <span id="stockInfo"></span> unidades</small><br>
                                        <strong>Precio: $<span id="precioInfo"></span></strong>
                                    </p>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <input type="number" class="form-control form-control-sm" id="cantidadProducto" min="1" value="1" placeholder="Cantidad">
                                        </div>
                                        <div class="col-6">
                                            <button class="btn btn-success btn-sm w-100" onclick="agregarProducto()">Agregar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Acciones rápidas -->
                <div class="card shadow-sm mt-3">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">Acciones</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-warning w-100 mb-2" onclick="consultarInventario()">
                            <i class="bi bi-box-seam"></i> Consultar Inventario
                        </button>
                    </div>
                </div>
            </div>

            <!-- Carrito de compra -->
            <div class="col-md-8">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Carrito de Compra</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                            <table class="table table-striped table-hover">
                                <thead class="table-dark sticky-top">
                                    <tr>
                                        <th>Código</th>
                                        <th>Producto</th>
                                        <th>Cantidad</th>
                                        <th>Precio Unit.</th>
                                        <th>Total</th>
                                        <th>Acción</th>
                                    </tr>
                                </thead>
                                <tbody id="carritoBody">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">No hay productos en el carrito</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Resumen de la compra -->
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-danger" onclick="limpiarCarrito()">
                                        <i class="bi bi-trash"></i> Limpiar Carrito
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <hr>
                                        <div class="row">
                                            <div class="col-6"><strong>TOTAL:</strong></div>
                                            <div class="col-6 text-end"><h4>$<span id="totalGeneral">0</span></h4></div>
                                        </div>
                                        <button class="btn btn-success w-100 mt-2" onclick="finalizarVenta()" id="btnFinalizar" disabled>
                                            <i class="bi bi-check-circle"></i> Finalizar Venta
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Inventario -->
    <div class="modal fade" id="inventarioModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Consulta de Inventario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Nombre</th>
                                    <th>Descripción</th>
                                    <th>Stock</th>
                                    <th>Precio</th>
                                </tr>
                            </thead>
                            <tbody id="inventarioBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmación de Venta -->
    <div class="modal fade" id="ventaModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">Venta Finalizada</h5>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-3">
                        <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
                    </div>
                    <h4>¡Venta Registrada Exitosamente!</h4>
                    <p>Número de Transacción: <strong id="transaccionFinalizada"></strong></p>
                    <p>Fecha de Transacción: <strong id="fechaTransaccionFinalizada"></strong></p>
                    <p>Total: <strong>$<span id="totalFinalizado"></span></strong></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="limpiar()">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
</body>
</html>